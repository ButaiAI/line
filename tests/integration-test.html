<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµ±åˆãƒ†ã‚¹ãƒˆ - é‡èœé›†è·ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #f5f5f5;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
            text-align: center;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 15px;
        }

        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }

        .test-section h2 {
            color: #34495e;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-result {
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            border-left: 4px solid;
        }

        .success {
            background-color: #d4edda;
            color: #155724;
            border-left-color: #28a745;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }

        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border-left-color: #17a2b8;
        }

        .warning {
            background-color: #fff3cd;
            color: #856404;
            border-left-color: #ffc107;
        }

        .btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin: 10px 10px 10px 0;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #5a6268);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
            color: #212529;
        }

        .btn-large {
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background-color: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            transition: width 0.3s ease;
            border-radius: 15px;
        }

        .config-section {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .config-item {
            display: flex;
            flex-direction: column;
        }

        .config-label {
            font-weight: 500;
            margin-bottom: 5px;
            color: #495057;
        }

        .config-input {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-left: 4px solid #4CAF50;
        }

        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            color: #6c757d;
            margin-top: 5px;
        }

        .log-output {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            margin: 15px 0;
            border: 1px solid #4a5568;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .config-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª é‡èœé›†è·ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  çµ±åˆãƒ†ã‚¹ãƒˆ</h1>
        
        <!-- Configuration Section -->
        <div class="config-section">
            <h3>ğŸ”§ ãƒ†ã‚¹ãƒˆè¨­å®š</h3>
            <div class="config-grid">
                <div class="config-item">
                    <label class="config-label">API Base URL:</label>
                    <input type="text" class="config-input" id="apiBaseUrl" value="/api">
                </div>
                <div class="config-item">
                    <label class="config-label">ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ LINE ID:</label>
                    <input type="text" class="config-input" id="testLineId" value="test-user-001">
                </div>
                <div class="config-item">
                    <label class="config-label">ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼å:</label>
                    <input type="text" class="config-input" id="testUserName" value="ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼">
                </div>
                <div class="config-item">
                    <label class="config-label">ç®¡ç†è€…ãƒˆãƒ¼ã‚¯ãƒ³:</label>
                    <input type="password" class="config-input" id="adminToken" placeholder="ç®¡ç†è€…JWTãƒˆãƒ¼ã‚¯ãƒ³">
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar" id="progressBarContainer" style="display: none;">
            <div class="progress" id="progressBar" style="width: 0%;"></div>
        </div>

        <!-- Overall Stats -->
        <div class="stats-grid" id="statsGrid" style="display: none;">
            <div class="stat-card">
                <div class="stat-number" id="totalTests">0</div>
                <div class="stat-label">ç·ãƒ†ã‚¹ãƒˆæ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="passedTests">0</div>
                <div class="stat-label">æˆåŠŸ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="failedTests">0</div>
                <div class="stat-label">å¤±æ•—</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="testDuration">0ms</div>
                <div class="stat-label">å®Ÿè¡Œæ™‚é–“</div>
            </div>
        </div>

        <!-- Authentication Tests -->
        <div class="test-section">
            <h2>ğŸ” èªè¨¼ãƒ†ã‚¹ãƒˆ</h2>
            <button class="btn" onclick="testAuth()">èªè¨¼ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button class="btn btn-secondary" onclick="clearResults('authResults')">ã‚¯ãƒªã‚¢</button>
            <div id="authResults"></div>
        </div>

        <!-- Vegetable API Tests -->
        <div class="test-section">
            <h2>ğŸŒ± é‡èœå“ç›®API ãƒ†ã‚¹ãƒˆ</h2>
            <button class="btn" onclick="testVegetableAPI()">å“ç›®APIãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button class="btn btn-secondary" onclick="clearResults('vegetableResults')">ã‚¯ãƒªã‚¢</button>
            <div id="vegetableResults"></div>
        </div>

        <!-- Harvest Request API Tests -->
        <div class="test-section">
            <h2>ğŸ“ é›†è·ç”³è«‹API ãƒ†ã‚¹ãƒˆ</h2>
            <button class="btn" onclick="testHarvestAPI()">ç”³è«‹APIãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button class="btn btn-secondary" onclick="clearResults('harvestResults')">ã‚¯ãƒªã‚¢</button>
            <div id="harvestResults"></div>
        </div>

        <!-- User Management API Tests -->
        <div class="test-section">
            <h2>ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†API ãƒ†ã‚¹ãƒˆ</h2>
            <button class="btn" onclick="testUserAPI()">ãƒ¦ãƒ¼ã‚¶ãƒ¼APIãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button class="btn btn-secondary" onclick="clearResults('userResults')">ã‚¯ãƒªã‚¢</button>
            <div id="userResults"></div>
        </div>

        <!-- LINE Integration Tests -->
        <div class="test-section">
            <h2>ğŸ“± LINEé€£æºãƒ†ã‚¹ãƒˆ</h2>
            <button class="btn" onclick="testLINEIntegration()">LINEé€£æºãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button class="btn btn-secondary" onclick="clearResults('lineResults')">ã‚¯ãƒªã‚¢</button>
            <div id="lineResults"></div>
        </div>

        <!-- Admin API Tests -->
        <div class="test-section">
            <h2>âš™ï¸ ç®¡ç†æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h2>
            <button class="btn" onclick="testAdminAPI()">ç®¡ç†APIãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button class="btn btn-secondary" onclick="clearResults('adminResults')">ã‚¯ãƒªã‚¢</button>
            <div id="adminResults"></div>
        </div>

        <!-- Performance Tests -->
        <div class="test-section">
            <h2>âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</h2>
            <button class="btn" onclick="testPerformance()">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button class="btn btn-secondary" onclick="clearResults('performanceResults')">ã‚¯ãƒªã‚¢</button>
            <div id="performanceResults"></div>
        </div>

        <!-- Error Handling Tests -->
        <div class="test-section">
            <h2>ğŸš¨ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ</h2>
            <button class="btn btn-warning" onclick="testErrorHandling()">ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button class="btn btn-secondary" onclick="clearResults('errorResults')">ã‚¯ãƒªã‚¢</button>
            <div id="errorResults"></div>
        </div>

        <!-- Overall Results -->
        <div class="test-section">
            <h2>ğŸ“Š ç·åˆçµæœ</h2>
            <button class="btn btn-large" onclick="runAllTests()">ğŸš€ å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button class="btn btn-danger" onclick="clearAllResults()">ğŸ—‘ï¸ å…¨çµæœã‚¯ãƒªã‚¢</button>
            <div id="overallResults"></div>
            <div class="log-output" id="testLog" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Global test state
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0,
            startTime: 0
        };

        let authToken = null;

        // Utility functions
        function getApiUrl() {
            return document.getElementById('apiBaseUrl').value;
        }

        function getTestConfig() {
            return {
                lineId: document.getElementById('testLineId').value,
                userName: document.getElementById('testUserName').value,
                adminToken: document.getElementById('adminToken').value
            };
        }

        function logResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(resultDiv);
            container.scrollTop = container.scrollHeight;

            // Update stats
            if (type === 'success') testStats.passed++;
            if (type === 'error') testStats.failed++;
            testStats.total++;
            updateStats();
        }

        function updateStats() {
            document.getElementById('totalTests').textContent = testStats.total;
            document.getElementById('passedTests').textContent = testStats.passed;
            document.getElementById('failedTests').textContent = testStats.failed;
            
            if (testStats.startTime) {
                const duration = Date.now() - testStats.startTime;
                document.getElementById('testDuration').textContent = `${duration}ms`;
            }

            document.getElementById('statsGrid').style.display = 'grid';
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        function clearAllResults() {
            const resultContainers = ['authResults', 'vegetableResults', 'harvestResults', 
                                    'userResults', 'lineResults', 'adminResults', 
                                    'performanceResults', 'errorResults', 'overallResults'];
            resultContainers.forEach(clearResults);
            
            testStats = { total: 0, passed: 0, failed: 0, startTime: 0 };
            updateStats();
            document.getElementById('statsGrid').style.display = 'none';
        }

        async function makeApiCall(endpoint, options = {}) {
            const url = `${getApiUrl()}${endpoint}`;
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json'
                }
            };

            if (authToken) {
                defaultOptions.headers['Authorization'] = `Bearer ${authToken}`;
            }

            const response = await fetch(url, { ...defaultOptions, ...options });
            const data = await response.json();
            
            return { response, data, status: response.status };
        }

        // Test Authentication
        async function testAuth() {
            const containerId = 'authResults';
            logResult(containerId, 'ğŸ” èªè¨¼ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');

            try {
                const config = getTestConfig();
                
                // Test login
                logResult(containerId, 'ãƒ†ã‚¹ãƒˆãƒ­ã‚°ã‚¤ãƒ³å®Ÿè¡Œä¸­...', 'info');
                const { response, data } = await makeApiCall('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({
                        lineId: config.lineId,
                        userName: config.userName
                    })
                });

                if (response.ok && data.success) {
                    authToken = data.token;
                    logResult(containerId, 'âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ', 'success');
                    logResult(containerId, `ãƒ¦ãƒ¼ã‚¶ãƒ¼: ${data.user.name}`, 'info');
                } else {
                    logResult(containerId, `âŒ ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—: ${data.error}`, 'error');
                    return;
                }

                // Test token validation
                logResult(containerId, 'ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ä¸­...', 'info');
                const { response: profileRes, data: profileData } = await makeApiCall('/auth/profile');
                
                if (profileRes.ok && profileData.success) {
                    logResult(containerId, 'âœ… ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼æˆåŠŸ', 'success');
                } else {
                    logResult(containerId, `âŒ ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼å¤±æ•—: ${profileData.error}`, 'error');
                }

            } catch (error) {
                logResult(containerId, `âŒ èªè¨¼ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // Test Vegetable API
        async function testVegetableAPI() {
            const containerId = 'vegetableResults';
            logResult(containerId, 'ğŸŒ± é‡èœå“ç›®APIãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');

            try {
                // Test get vegetables (public endpoint)
                logResult(containerId, 'é‡èœå“ç›®ä¸€è¦§å–å¾—ä¸­...', 'info');
                const { response, data } = await makeApiCall('/vegetables/list');

                if (response.ok && data.success) {
                    logResult(containerId, `âœ… é‡èœå“ç›®å–å¾—æˆåŠŸ (${data.data.length}ä»¶)`, 'success');
                    
                    if (data.data.length > 0) {
                        const firstVegetable = data.data[0];
                        logResult(containerId, `ä¾‹: ${firstVegetable.name}`, 'info');
                    }
                } else {
                    logResult(containerId, `âŒ é‡èœå“ç›®å–å¾—å¤±æ•—: ${data.error}`, 'error');
                }

                // Test create vegetable (admin only)
                if (authToken) {
                    logResult(containerId, 'é‡èœå“ç›®ä½œæˆãƒ†ã‚¹ãƒˆä¸­...', 'info');
                    const createResult = await makeApiCall('/vegetables/create', {
                        method: 'POST',
                        body: JSON.stringify({
                            name: `ãƒ†ã‚¹ãƒˆé‡èœ_${Date.now()}`,
                            description: 'ãƒ†ã‚¹ãƒˆç”¨é‡èœå“ç›®'
                        })
                    });

                    if (createResult.response.ok) {
                        logResult(containerId, 'âœ… é‡èœå“ç›®ä½œæˆæˆåŠŸ', 'success');
                    } else {
                        logResult(containerId, `âš ï¸ é‡èœå“ç›®ä½œæˆ: ${createResult.data.error}`, 'warning');
                    }
                }

            } catch (error) {
                logResult(containerId, `âŒ é‡èœå“ç›®APIãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // Test Harvest Request API
        async function testHarvestAPI() {
            const containerId = 'harvestResults';
            logResult(containerId, 'ğŸ“ é›†è·ç”³è«‹APIãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');

            if (!authToken) {
                logResult(containerId, 'âŒ èªè¨¼ãŒå¿…è¦ã§ã™ã€‚å…ˆã«èªè¨¼ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„', 'error');
                return;
            }

            try {
                // Test create harvest request
                logResult(containerId, 'é›†è·ç”³è«‹ä½œæˆä¸­...', 'info');
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                
                const { response, data } = await makeApiCall('/harvest/submit', {
                    method: 'POST',
                    body: JSON.stringify({
                        vegetable_item: 'ãƒˆãƒãƒˆ',
                        delivery_date: tomorrow.toISOString().split('T')[0],
                        time_slot: 'morning',
                        quantity: 10.5,
                        location: 'ãƒ†ã‚¹ãƒˆè¾²å ´',
                        contact_phone: '090-1234-5678',
                        notes: 'ãƒ†ã‚¹ãƒˆç”³è«‹'
                    })
                });

                if (response.ok && data.success) {
                    logResult(containerId, 'âœ… é›†è·ç”³è«‹ä½œæˆæˆåŠŸ', 'success');
                    
                    // Test get harvest requests
                    logResult(containerId, 'ç”³è«‹ä¸€è¦§å–å¾—ä¸­...', 'info');
                    const { response: listRes, data: listData } = await makeApiCall('/harvest/list');
                    
                    if (listRes.ok && listData.success) {
                        logResult(containerId, `âœ… ç”³è«‹ä¸€è¦§å–å¾—æˆåŠŸ (${listData.data.length}ä»¶)`, 'success');
                    } else {
                        logResult(containerId, `âŒ ç”³è«‹ä¸€è¦§å–å¾—å¤±æ•—: ${listData.error}`, 'error');
                    }
                } else {
                    logResult(containerId, `âŒ é›†è·ç”³è«‹ä½œæˆå¤±æ•—: ${data.error}`, 'error');
                }

            } catch (error) {
                logResult(containerId, `âŒ é›†è·ç”³è«‹APIãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // Test User Management API
        async function testUserAPI() {
            const containerId = 'userResults';
            logResult(containerId, 'ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†APIãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');

            try {
                const config = getTestConfig();
                
                // Test get users (requires admin token)
                if (config.adminToken) {
                    logResult(containerId, 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—ä¸­...', 'info');
                    const { response, data } = await makeApiCall('/users/list', {
                        headers: { 'Authorization': `Bearer ${config.adminToken}` }
                    });

                    if (response.ok && data.success) {
                        logResult(containerId, `âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—æˆåŠŸ (${data.data.length}ä»¶)`, 'success');
                    } else {
                        logResult(containerId, `âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—å¤±æ•—: ${data.error}`, 'error');
                    }
                } else {
                    logResult(containerId, 'âš ï¸ ç®¡ç†è€…ãƒˆãƒ¼ã‚¯ãƒ³ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“', 'warning');
                }

            } catch (error) {
                logResult(containerId, `âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†APIãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // Test LINE Integration
        async function testLINEIntegration() {
            const containerId = 'lineResults';
            logResult(containerId, 'ğŸ“± LINEé€£æºãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');

            try {
                // Test LINE webhook (basic structure check)
                logResult(containerId, 'LINE Webhookã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç¢ºèªä¸­...', 'info');
                const { response } = await fetch(`${getApiUrl()}/webhook/line`, {
                    method: 'GET'
                });

                if (response.status === 405) {
                    logResult(containerId, 'âœ… LINE Webhookã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç¢ºèªå®Œäº†', 'success');
                } else {
                    logResult(containerId, `âš ï¸ äºˆæœŸã—ãªã„ãƒ¬ã‚¹ãƒãƒ³ã‚¹: ${response.status}`, 'warning');
                }

                // Test announcement broadcast (if admin token available)
                const config = getTestConfig();
                if (config.adminToken) {
                    logResult(containerId, 'ãŠçŸ¥ã‚‰ã›é…ä¿¡ãƒ†ã‚¹ãƒˆä¸­...', 'info');
                    const { response: announceRes, data: announceData } = await makeApiCall('/admin/announcements', {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${config.adminToken}` },
                        body: JSON.stringify({
                            title: 'ãƒ†ã‚¹ãƒˆãŠçŸ¥ã‚‰ã›',
                            message: 'ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆç”¨ã®ãŠçŸ¥ã‚‰ã›ã§ã™',
                            send_line: false,
                            recipients: 'all'
                        })
                    });

                    if (announceRes.ok && announceData.success) {
                        logResult(containerId, 'âœ… ãŠçŸ¥ã‚‰ã›ä½œæˆæˆåŠŸ', 'success');
                    } else {
                        logResult(containerId, `âŒ ãŠçŸ¥ã‚‰ã›ä½œæˆå¤±æ•—: ${announceData.error}`, 'error');
                    }
                }

            } catch (error) {
                logResult(containerId, `âŒ LINEé€£æºãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // Test Admin API
        async function testAdminAPI() {
            const containerId = 'adminResults';
            logResult(containerId, 'âš™ï¸ ç®¡ç†æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');

            const config = getTestConfig();
            if (!config.adminToken) {
                logResult(containerId, 'âŒ ç®¡ç†è€…ãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦ã§ã™', 'error');
                return;
            }

            try {
                // Test dashboard API
                logResult(containerId, 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æƒ…å ±å–å¾—ä¸­...', 'info');
                const { response, data } = await makeApiCall('/admin/dashboard', {
                    headers: { 'Authorization': `Bearer ${config.adminToken}` }
                });

                if (response.ok && data.success) {
                    logResult(containerId, 'âœ… ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æƒ…å ±å–å¾—æˆåŠŸ', 'success');
                    logResult(containerId, `ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: ${data.data.summary.users.total}`, 'info');
                    logResult(containerId, `ç”³è«‹ä¸­: ${data.data.summary.harvest.pending}`, 'info');
                } else {
                    logResult(containerId, `âŒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å–å¾—å¤±æ•—: ${data.error}`, 'error');
                }

            } catch (error) {
                logResult(containerId, `âŒ ç®¡ç†æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // Test Performance
        async function testPerformance() {
            const containerId = 'performanceResults';
            logResult(containerId, 'âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');

            const tests = [
                { name: 'é‡èœå“ç›®ä¸€è¦§', endpoint: '/vegetables/list' },
                { name: 'ç”³è«‹ä¸€è¦§', endpoint: '/harvest/list', auth: true }
            ];

            for (const test of tests) {
                try {
                    const startTime = performance.now();
                    
                    const options = test.auth && authToken ? 
                        { headers: { 'Authorization': `Bearer ${authToken}` } } : {};
                    
                    const { response } = await makeApiCall(test.endpoint, options);
                    const endTime = performance.now();
                    const duration = Math.round(endTime - startTime);

                    if (response.ok) {
                        const status = duration < 1000 ? 'âœ…' : duration < 3000 ? 'âš ï¸' : 'âŒ';
                        logResult(containerId, `${status} ${test.name}: ${duration}ms`, 
                                 duration < 1000 ? 'success' : duration < 3000 ? 'warning' : 'error');
                    } else {
                        logResult(containerId, `âŒ ${test.name}: HTTP ${response.status}`, 'error');
                    }
                } catch (error) {
                    logResult(containerId, `âŒ ${test.name}: ${error.message}`, 'error');
                }
            }
        }

        // Test Error Handling
        async function testErrorHandling() {
            const containerId = 'errorResults';
            logResult(containerId, 'ğŸš¨ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');

            const errorTests = [
                { name: 'å­˜åœ¨ã—ãªã„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ', endpoint: '/nonexistent', expectedStatus: 404 },
                { name: 'ç„¡åŠ¹ãªJSON', endpoint: '/auth/login', method: 'POST', body: 'invalid json', expectedStatus: 400 },
                { name: 'èªè¨¼ãªã—ã§ãƒ—ãƒ­ãƒ†ã‚¯ãƒˆæ¸ˆã¿ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ', endpoint: '/harvest/list', expectedStatus: 401 }
            ];

            for (const test of errorTests) {
                try {
                    const options = {
                        method: test.method || 'GET'
                    };

                    if (test.body) {
                        options.body = test.body;
                        options.headers = { 'Content-Type': 'application/json' };
                    }

                    const { response } = await fetch(`${getApiUrl()}${test.endpoint}`, options);
                    
                    if (response.status === test.expectedStatus) {
                        logResult(containerId, `âœ… ${test.name}: æœŸå¾…é€šã‚Šã®ã‚¨ãƒ©ãƒ¼ (${response.status})`, 'success');
                    } else {
                        logResult(containerId, `âš ï¸ ${test.name}: äºˆæœŸã—ãªã„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ (${response.status})`, 'warning');
                    }
                } catch (error) {
                    logResult(containerId, `âŒ ${test.name}: ${error.message}`, 'error');
                }
            }
        }

        // Run All Tests
        async function runAllTests() {
            clearAllResults();
            testStats.startTime = Date.now();
            
            const progressBar = document.getElementById('progressBar');
            const progressContainer = document.getElementById('progressBarContainer');
            progressContainer.style.display = 'block';

            const tests = [
                testAuth,
                testVegetableAPI,
                testHarvestAPI,
                testUserAPI,
                testLINEIntegration,
                testAdminAPI,
                testPerformance,
                testErrorHandling
            ];

            logResult('overallResults', 'ğŸš€ å…¨ä½“ãƒ†ã‚¹ãƒˆå®Ÿè¡Œé–‹å§‹', 'info');

            for (let i = 0; i < tests.length; i++) {
                const progress = ((i + 1) / tests.length) * 100;
                progressBar.style.width = `${progress}%`;
                
                try {
                    await tests[i]();
                    await new Promise(resolve => setTimeout(resolve, 500)); // Small delay between tests
                } catch (error) {
                    logResult('overallResults', `âŒ ãƒ†ã‚¹ãƒˆ ${i + 1} ã§ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            }

            logResult('overallResults', 'ğŸ å…¨ä½“ãƒ†ã‚¹ãƒˆå®Œäº†', 'info');
            logResult('overallResults', `æˆåŠŸ: ${testStats.passed}, å¤±æ•—: ${testStats.failed}, ç·æ•°: ${testStats.total}`, 'info');
            
            progressContainer.style.display = 'none';
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            logResult('overallResults', 'ğŸ§ª çµ±åˆãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†', 'info');
            logResult('overallResults', 'å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã‹ã€ã€Œå…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã€ã§ä¸€æ‹¬å®Ÿè¡Œã—ã¦ãã ã•ã„', 'info');
        });
    </script>
</body>
</html>